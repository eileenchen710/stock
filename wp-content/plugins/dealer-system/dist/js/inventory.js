import{r as a,j as e,m as u,c as ne}from"./chunks/index-ClKf2CbM.js";import{G as oe}from"./chunks/GradientText-BvkcKc4C.js";import{B as N}from"./chunks/Button-zSFrK51C.js";import{I as F}from"./chunks/Input-GJFWVui3.js";import{A as _,T as ie,a as ce,b as le,c as g,d as de,e as y}from"./chunks/Table-CJsp_9j5.js";const $=a.forwardRef(({className:s="",variant:i="default",style:d,...h},k)=>{const b=i==="destructive"?"border-red-200 bg-red-50 text-red-900":"border-green-200 bg-green-50 text-green-900";return e.jsx("div",{ref:k,role:"alert",className:`relative w-full rounded-xl border text-sm flex items-start gap-3 shadow-lg ${b} ${s}`,style:{padding:"16px",...d},...h})});$.displayName="Alert";const P=a.forwardRef(({className:s="",...i},d)=>e.jsx("h5",{ref:d,className:`font-medium leading-none tracking-tight ${s}`,...i}));P.displayName="AlertTitle";const U=a.forwardRef(({className:s="",...i},d)=>e.jsx("div",{ref:d,className:`text-sm opacity-90 ${s}`,...i}));U.displayName="AlertDescription";const xe=({open:s,onOpenChange:i,children:d})=>e.jsx(_,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>i(!1),className:"fixed inset-0 bg-black/50 z-50"}),e.jsx(u.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md px-4",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl",style:{padding:"24px"},children:d})})]})}),ue=({children:s})=>e.jsx("div",{className:"mb-4",children:s}),me=({children:s})=>e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s}),he=({children:s})=>e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:s}),pe=({children:s})=>e.jsx("div",{className:"flex justify-end gap-3 mt-6",children:s}),fe={stock_order:"Stock Order",daily_order:"Daily Order",vor_order:"VOR Order"};function ge(){const s=window.dealerInventory||{products:[],cartUrl:"/cart/",nonce:"",ajaxUrl:"",addToCartNonce:"",searchNonce:""},[i,d]=a.useState([]),[h,k]=a.useState(""),[b,z]=a.useState({}),[A,H]=a.useState({}),[R,D]=a.useState(null),[L,O]=a.useState(!0),[w,B]=a.useState(!1),[G,K]=a.useState(1),[E,Q]=a.useState(!1),[W,Y]=a.useState(0),[V,I]=a.useState(!1),[m,p]=a.useState(null),[c,j]=a.useState({open:!1,product:null,quantity:0,reason:"out_of_stock"}),v=a.useRef(null),S=a.useRef(null),T=a.useRef(0),C=async(t,r,l=!1)=>{S.current&&S.current.abort();const o=new AbortController;S.current=o;const x=++T.current;r===1&&!l?O(!0):B(!0);try{const n=new FormData;n.append("action","dealer_search_products"),n.append("nonce",s.searchNonce),n.append("search",t),n.append("page",String(r));const f=await(await fetch(s.ajaxUrl,{method:"POST",body:n,signal:o.signal})).json();if(x!==T.current)return;f.success&&(d(l?re=>[...re,...f.data.products]:f.data.products),Q(f.data.has_more),Y(f.data.total),K(f.data.page))}catch(n){if(n instanceof Error&&n.name==="AbortError")return;console.error("Failed to fetch products:",n)}finally{x===T.current&&(O(!1),B(!1),I(!1))}};a.useEffect(()=>{C("",1)},[]);const J=t=>{k(t),I(!0),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{C(t,1)},500)},X=()=>{!w&&E&&C(h,G+1,!0)},Z=t=>t<=0?{text:"Out of Stock",className:"text-red-600"}:t<=10?{text:"Low Stock",className:"text-amber-600"}:{text:"In Stock",className:"text-green-600"},ee=(t,r)=>{z(l=>({...l,[t]:r}))},te=(t,r)=>{H(l=>({...l,[t]:r}))},q=async(t,r)=>{const l=A[t.id]||"stock_order";D(t.id);try{const o=new FormData;o.append("action","dealer_add_to_cart"),o.append("nonce",s.addToCartNonce),o.append("product_id",String(t.id)),o.append("quantity",String(r)),o.append("order_type",l);const n=await(await fetch(s.ajaxUrl,{method:"POST",body:o})).json();n.success?(p({show:!0,product:t.name,quantity:r}),setTimeout(()=>p(null),3e3)):(console.error("Failed to add to cart:",n.data?.message),p({show:!0,product:t.name,quantity:r,error:!0,message:n.data?.message||"Unknown error"}),setTimeout(()=>p(null),4e3))}catch(o){console.error("Failed to add to cart:",o),p({show:!0,product:t.name,quantity:r,error:!0,message:"Network error"}),setTimeout(()=>p(null),4e3)}finally{D(null)}},ae=t=>{const r=b[t.id]||1;if(t.stock<=0){j({open:!0,product:t,quantity:r,reason:"out_of_stock"});return}if(r>t.stock){j({open:!0,product:t,quantity:r,reason:"exceeds_stock"});return}q(t,r)},se=()=>{c.product&&q(c.product,c.quantity),j({open:!1,product:null,quantity:0,reason:"out_of_stock"})};return e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"page-content",children:[e.jsx(_,{children:m?.show&&e.jsx(u.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"fixed bottom-6 right-6 z-50 w-full max-w-sm",children:e.jsxs($,{variant:m.error?"destructive":"default",children:[m.error?e.jsx("svg",{className:"h-4 w-4 text-red-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"h-4 w-4 text-green-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx(P,{children:m.error?"Error":"Added to Cart"}),e.jsx(U,{children:m.error?m.message:`${m.quantity}x ${m.product}`})]})]})})}),e.jsxs(xe,{open:c.open,onOpenChange:t=>j(r=>({...r,open:t})),children:[e.jsxs(ue,{children:[e.jsx(me,{children:"Confirm Backorder"}),e.jsx(he,{children:c.reason==="out_of_stock"?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:c.product?.name})," is currently out of stock.",e.jsx("br",{}),"This will be placed as a ",e.jsx("strong",{children:"backorder"})," and fulfilled when stock becomes available."]}):e.jsxs(e.Fragment,{children:["You are ordering ",e.jsx("strong",{children:c.quantity})," units of ",e.jsx("strong",{children:c.product?.name}),", but only ",e.jsx("strong",{children:c.product?.stock})," units are in stock.",e.jsx("br",{}),"The remaining ",e.jsx("strong",{children:c.quantity-(c.product?.stock||0)})," units will be placed as a ",e.jsx("strong",{children:"backorder"}),"."]})})]}),e.jsxs(pe,{children:[e.jsx(N,{onClick:()=>j({open:!1,product:null,quantity:0,reason:"out_of_stock"}),style:{background:"#f3f4f6",color:"#374151"},children:"Cancel"}),e.jsx(N,{onClick:se,children:"Confirm Backorder"})]})]}),e.jsxs(u.div,{className:"mb-8 text-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:e.jsx(oe,{animationSpeed:4,children:"Inventory"})}),e.jsx("p",{className:"text-gray-500",children:"Browse and order products"})]}),e.jsx(u.div,{className:"!mb-4 flex justify-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(F,{type:"text",placeholder:"Search by SKU or product name...",value:h,onChange:t=>J(t.target.value),className:"max-w-md w-full !rounded-full"})}),L?e.jsxs(u.div,{className:"text-center py-16",initial:{opacity:0},animate:{opacity:1},children:[e.jsx("div",{className:"inline-block w-8 h-8 border-2 border-gray-300 border-t-gray-900 rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading products..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white overflow-hidden",children:e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsxs(le,{children:[e.jsx(g,{children:"SKU"}),e.jsx(g,{children:"Product"}),e.jsx(g,{className:"text-right",children:"Stock"}),e.jsx(g,{children:"Status"}),e.jsx(g,{children:"Type"}),e.jsx(g,{className:"text-right",children:"Order"})]})}),e.jsx(de,{children:e.jsx(_,{children:i.map((t,r)=>{const l=Z(t.stock),o=A[t.id]||"stock_order";return e.jsxs(u.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:r*.02},className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx(y,{className:"font-mono text-gray-600",children:t.sku||"-"}),e.jsx(y,{className:"font-medium text-gray-900",children:t.name}),e.jsx(y,{className:"text-right text-gray-700",children:t.stock??"N/A"}),e.jsx(y,{children:e.jsx("span",{className:`font-medium ${l.className}`,children:l.text})}),e.jsx(y,{children:e.jsx("select",{value:o,onChange:x=>te(t.id,x.target.value),className:"h-10 px-3 py-2 text-sm border border-gray-200 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent",children:Object.entries(fe).map(([x,n])=>e.jsx("option",{value:x,children:n},x))})}),e.jsx(y,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(F,{type:"number",min:1,value:b[t.id]||1,onChange:x=>ee(t.id,parseInt(x.target.value)||1),className:"w-20 h-8 text-center"}),e.jsx(N,{size:"sm",onClick:()=>ae(t),disabled:R===t.id,children:R===t.id?"...":"Add"})]})})]},t.id)})})})]})}),i.length===0&&!L&&e.jsx(u.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},children:e.jsx("p",{className:"text-gray-500",children:h?`No products found matching "${h}"`:"No products available"})}),e.jsxs(u.div,{className:"mt-6 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:[E&&!h&&e.jsx(N,{onClick:X,disabled:w,className:"mb-4",children:w?"Loading...":"Load More"}),e.jsx("p",{className:"text-sm text-gray-400",children:V?"Searching...":`Showing ${i.length} of ${W} products`})]})]})]})})}const M=document.getElementById("dealer-inventory-root");M&&ne.createRoot(M).render(e.jsx(a.StrictMode,{children:e.jsx(ge,{})}));
