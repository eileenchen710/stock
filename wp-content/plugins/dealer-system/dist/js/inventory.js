import{j as e,m as i,c as Y,r as n}from"./chunks/index-ClKf2CbM.js";import{G as J}from"./chunks/GradientText-BvkcKc4C.js";import{B as v}from"./chunks/Button-zSFrK51C.js";import{I as L}from"./chunks/Input-GJFWVui3.js";import{T as X,a as Z,b as ee,c as x,d as te,e as h}from"./chunks/Table-LW9oDM4-.js";import{A as re,a as se,b as ae}from"./chunks/Alert-B5GFDb8d.js";import{A as T}from"./chunks/index-CWUfAGMP.js";const ne=({open:a,onOpenChange:m,children:p})=>e.jsx(T,{children:a&&e.jsxs(e.Fragment,{children:[e.jsx(i.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>m(!1),className:"fixed inset-0 bg-black/50 z-50"}),e.jsx(i.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md px-4",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl",style:{padding:"24px"},children:p})})]})}),oe=({children:a})=>e.jsx("div",{className:"mb-4",children:a}),ie=({children:a})=>e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a}),ce=({children:a})=>e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:a}),le=({children:a})=>e.jsx("div",{className:"flex justify-end gap-3 mt-6",children:a}),de={stock_order:"Stock Order",daily_order:"Daily Order",vor_order:"VOR Order"};function xe(){const a=window.dealerInventory||{products:[],cartUrl:"/cart/",nonce:"",ajaxUrl:"",addToCartNonce:"",searchNonce:"",isWarehouseManager:!1},m=a.isWarehouseManager,[p,S]=n.useState([]),[C,U]=n.useState(""),[_,z]=n.useState({}),[D,W]=n.useState({}),[F,R]=n.useState(null),[A,B]=n.useState(!1),[O,E]=n.useState(0),[y,g]=n.useState(!1),[P,q]=n.useState(!1),[l,u]=n.useState(null),[o,j]=n.useState({open:!1,product:null,quantity:0,reason:"out_of_stock"}),f=n.useRef(null),b=n.useRef(null),k=n.useRef(0),$=async t=>{b.current&&b.current.abort();const s=new AbortController;b.current=s;const c=++k.current;B(!0);try{const r=new FormData;r.append("action","dealer_search_products"),r.append("nonce",a.searchNonce),r.append("search",t),r.append("page","1");const d=await(await fetch(a.ajaxUrl,{method:"POST",body:r,signal:s.signal})).json();if(c!==k.current)return;d.success&&(S(d.data.products),E(d.data.total))}catch(r){if(r instanceof Error&&r.name==="AbortError")return;console.error("Failed to fetch products:",r)}finally{c===k.current&&(B(!1),g(!1))}},H=t=>{U(t),f.current&&clearTimeout(f.current),t.trim()?(g(!0),f.current=setTimeout(()=>{q(!0),$(t)},500)):(S([]),q(!1),g(!1),E(0))},K=(t,s)=>{z(c=>({...c,[t]:s}))},G=(t,s)=>{W(c=>({...c,[t]:s}))},I=async(t,s)=>{const c=D[t.id]||"stock_order";R(t.id);try{const r=new FormData;r.append("action","dealer_add_to_cart"),r.append("nonce",a.addToCartNonce),r.append("product_id",String(t.id)),r.append("quantity",String(s)),r.append("order_type",c);const d=await(await fetch(a.ajaxUrl,{method:"POST",body:r})).json();d.success?(u({show:!0,product:t.name,quantity:s}),setTimeout(()=>u(null),3e3)):(console.error("Failed to add to cart:",d.data?.message),u({show:!0,product:t.name,quantity:s,error:!0,message:d.data?.message||"Unknown error"}),setTimeout(()=>u(null),4e3))}catch(r){console.error("Failed to add to cart:",r),u({show:!0,product:t.name,quantity:s,error:!0,message:"Network error"}),setTimeout(()=>u(null),4e3)}finally{R(null)}},Q=t=>{const s=_[t.id]||1;if(t.stock<=0){j({open:!0,product:t,quantity:s,reason:"out_of_stock"});return}if(s>t.stock){j({open:!0,product:t,quantity:s,reason:"exceeds_stock"});return}I(t,s)},V=()=>{o.product&&I(o.product,o.quantity),j({open:!1,product:null,quantity:0,reason:"out_of_stock"})},N=!P&&!y&&p.length===0;return e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"page-content",style:{paddingTop:"120px"},children:[e.jsx(T,{children:l?.show&&e.jsx(i.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"fixed bottom-6 right-6 z-50 w-full max-w-sm",children:e.jsxs(re,{variant:l.error?"destructive":"default",children:[l.error?e.jsx("svg",{className:"h-4 w-4 text-red-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"h-4 w-4 text-green-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx(se,{children:l.error?"Error":"Added to Cart"}),e.jsx(ae,{children:l.error?l.message:`${l.quantity}x ${l.product}`})]})]})})}),e.jsxs(ne,{open:o.open,onOpenChange:t=>j(s=>({...s,open:t})),children:[e.jsxs(oe,{children:[e.jsx(ie,{children:"Confirm Backorder"}),e.jsx(ce,{children:o.reason==="out_of_stock"?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:o.product?.name})," is currently out of stock.",e.jsx("br",{}),"This will be placed as a ",e.jsx("strong",{children:"backorder"})," and fulfilled when stock becomes available."]}):e.jsxs(e.Fragment,{children:["You are ordering ",e.jsx("strong",{children:o.quantity})," units of ",e.jsx("strong",{children:o.product?.name}),", but only ",e.jsx("strong",{children:o.product?.stock})," units are in stock.",e.jsx("br",{}),"The remaining ",e.jsx("strong",{children:o.quantity-(o.product?.stock||0)})," units will be placed as a ",e.jsx("strong",{children:"backorder"}),"."]})})]}),e.jsxs(le,{children:[e.jsx(v,{onClick:()=>j({open:!1,product:null,quantity:0,reason:"out_of_stock"}),style:{background:"#f3f4f6",color:"#374151"},children:"Cancel"}),e.jsx(v,{onClick:V,children:"Confirm Backorder"})]})]}),e.jsx("div",{className:N?"fixed inset-0 flex items-center justify-center":"",children:e.jsxs("div",{className:N?"w-full max-w-md px-4":"",children:[e.jsxs(i.div,{className:"mb-8 text-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:e.jsx(J,{animationSpeed:4,children:"Inventory"})}),e.jsx("p",{className:"text-gray-500",children:"Browse and order products"})]}),e.jsx(i.div,{className:"!mb-4 flex justify-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(L,{type:"text",placeholder:"Search by SKU or product name...",value:C,onChange:t=>H(t.target.value),className:"max-w-md w-full !rounded-full"})}),N&&e.jsx(i.div,{className:"text-center mt-6",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("p",{className:"text-gray-400 text-base flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Enter SKU or product name to search"]})})]})}),(A||y)&&e.jsxs(i.div,{className:"text-center py-16",initial:{opacity:0},animate:{opacity:1},children:[e.jsx("div",{className:"inline-block w-8 h-8 border-2 border-gray-300 border-t-gray-900 rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Searching..."})]}),P&&!A&&!y&&e.jsx(e.Fragment,{children:p.length>0?e.jsxs(e.Fragment,{children:[e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white overflow-hidden",children:e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(x,{children:"SKU"}),e.jsx(x,{children:"Product"}),e.jsx(x,{className:"text-right",children:"Stock Price"}),e.jsx(x,{className:"text-right",children:"Daily Price"}),e.jsx(x,{className:"text-right",children:"VOR Price"}),!m&&e.jsx(x,{children:"Type"}),!m&&e.jsx(x,{className:"text-right",children:"Order"})]})}),e.jsx(te,{children:e.jsx(T,{children:p.map((t,s)=>{const c=D[t.id]||"stock_order";return e.jsxs(i.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:s*.02},className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx(h,{className:"font-mono text-gray-600",children:t.sku||"-"}),e.jsx(h,{className:"font-medium text-gray-900",children:t.name}),e.jsxs(h,{className:"text-right text-gray-600",children:["$",t.prices.stock_order.toFixed(2)]}),e.jsxs(h,{className:"text-right text-gray-600",children:["$",t.prices.daily_order.toFixed(2)]}),e.jsxs(h,{className:"text-right text-gray-600",children:["$",t.prices.vor_order.toFixed(2)]}),!m&&e.jsx(h,{children:e.jsx("select",{value:c,onChange:r=>G(t.id,r.target.value),className:"h-10 px-3 py-2 text-sm border border-gray-200 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent",children:Object.entries(de).map(([r,w])=>e.jsx("option",{value:r,children:w},r))})}),!m&&e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(L,{type:"number",min:1,value:_[t.id]||1,onChange:r=>K(t.id,parseInt(r.target.value)||1),className:"w-20 h-8 text-center"}),e.jsx(v,{size:"sm",onClick:()=>Q(t),disabled:F===t.id,children:F===t.id?"...":"Add"})]})})]},t.id)})})})]})}),e.jsx(i.div,{className:"mt-6 text-center",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("p",{className:"text-sm text-gray-400",children:["Found ",O," product",O!==1?"s":""]})})]}):e.jsx(i.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("p",{className:"text-gray-500",children:['No products found matching "',C,'"']})})})]})})}const M=document.getElementById("dealer-inventory-root");M&&Y.createRoot(M).render(e.jsx(n.StrictMode,{children:e.jsx(xe,{})}));
