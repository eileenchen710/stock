import{c as Q,j as e,r as s,m as i,B as C}from"./chunks/index-Z1th90C1.js";import{G as z}from"./chunks/GradientText-DJbbYQlN.js";import{I as _}from"./chunks/Input-DUc8ouzG.js";import{T as V,a as Y,b as J,c as l,d as W,e as m}from"./chunks/Table-Dr_UeMuC.js";import{A as X}from"./chunks/index-CdJNFGGB.js";const Z={stock_order:"Stock Order",daily_order:"Daily Order",vor_order:"VOR Order"};function ee(){const d=window.dealerInventory||{products:[],cartUrl:"/cart/",nonce:"",ajaxUrl:"",addToCartNonce:"",searchNonce:""},[u,g]=s.useState([]),[h,I]=s.useState(""),[j,L]=s.useState({}),[f,P]=s.useState({}),[N,b]=s.useState(null),[S,T]=s.useState(!0),[p,v]=s.useState(!1),[E,F]=s.useState(1),[w,R]=s.useState(!1),[U,A]=s.useState(0),[M,k]=s.useState(!1),y=s.useRef(null),x=s.useCallback(async(t,o,n=!1)=>{o===1&&!n?T(!0):v(!0);try{const a=new FormData;a.append("action","dealer_search_products"),a.append("nonce",d.searchNonce),a.append("search",t),a.append("page",String(o));const r=await(await fetch(d.ajaxUrl,{method:"POST",body:a})).json();r.success&&(g(n?K=>[...K,...r.data.products]:r.data.products),R(r.data.has_more),A(r.data.total),F(r.data.page))}catch(a){console.error("Failed to fetch products:",a)}finally{T(!1),v(!1),k(!1)}},[d.ajaxUrl,d.searchNonce]);s.useEffect(()=>{x("",1)},[x]);const B=t=>{I(t),k(!0),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{x(t,1)},300)},D=()=>{!p&&w&&x(h,E+1,!0)},$=t=>t<=0?{text:"Out of Stock",className:"text-red-600"}:t<=10?{text:"Low Stock",className:"text-amber-600"}:{text:"In Stock",className:"text-green-600"},q=(t,o)=>{L(n=>({...n,[t]:o}))},H=(t,o)=>{P(n=>({...n,[t]:o}))},G=async t=>{const o=j[t.id]||1,n=f[t.id]||"stock_order";b(t.id);try{const a=new FormData;a.append("action","dealer_add_to_cart"),a.append("nonce",d.addToCartNonce),a.append("product_id",String(t.id)),a.append("quantity",String(o)),a.append("order_type",n);const r=await(await fetch(d.ajaxUrl,{method:"POST",body:a})).json();r.success?window.location.reload():(console.error("Failed to add to cart:",r.data?.message),alert("Failed to add to cart: "+(r.data?.message||"Unknown error")))}catch(a){console.error("Failed to add to cart:",a),alert("Failed to add to cart")}finally{b(null)}};return e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"page-content",children:[e.jsxs(i.div,{className:"mb-8 text-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:e.jsx(z,{animationSpeed:4,children:"Inventory"})}),e.jsx("p",{className:"text-gray-500",children:"Browse and order products"})]}),e.jsx(i.div,{className:"!mb-4 flex justify-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(_,{type:"text",placeholder:"Search by SKU or product name...",value:h,onChange:t=>B(t.target.value),className:"max-w-md w-full !rounded-full"})}),S?e.jsxs(i.div,{className:"text-center py-16",initial:{opacity:0},animate:{opacity:1},children:[e.jsx("div",{className:"inline-block w-8 h-8 border-2 border-gray-300 border-t-gray-900 rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading products..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-3xl overflow-hidden",children:e.jsxs(V,{children:[e.jsx(Y,{children:e.jsxs(J,{children:[e.jsx(l,{children:"SKU"}),e.jsx(l,{children:"Product"}),e.jsx(l,{className:"text-right",children:"Stock"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Type"}),e.jsx(l,{className:"text-right",children:"Order"})]})}),e.jsx(W,{children:e.jsx(X,{children:u.map((t,o)=>{const n=$(t.stock),a=f[t.id]||"stock_order";return e.jsxs(i.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:o*.02},className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx(m,{className:"font-mono text-gray-600",children:t.sku||"-"}),e.jsx(m,{className:"font-medium text-gray-900",children:t.name}),e.jsx(m,{className:"text-right text-gray-700",children:t.stock??"N/A"}),e.jsx(m,{children:e.jsx("span",{className:`font-medium ${n.className}`,children:n.text})}),e.jsx(m,{children:e.jsx("select",{value:a,onChange:c=>H(t.id,c.target.value),className:"h-10 px-3 py-2 text-sm border border-gray-200 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent",children:Object.entries(Z).map(([c,r])=>e.jsx("option",{value:c,children:r},c))})}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(_,{type:"number",min:1,value:j[t.id]||1,onChange:c=>q(t.id,parseInt(c.target.value)||1),className:"w-20 h-8 text-center"}),e.jsx(C,{size:"sm",onClick:()=>G(t),disabled:N===t.id,children:N===t.id?"...":"Add"})]})})]},t.id)})})})]})}),u.length===0&&!S&&e.jsx(i.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},children:e.jsx("p",{className:"text-gray-500",children:h?`No products found matching "${h}"`:"No products available"})}),e.jsxs(i.div,{className:"mt-6 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:[w&&!h&&e.jsx(C,{onClick:D,disabled:p,className:"mb-4",children:p?"Loading...":"Load More"}),e.jsx("p",{className:"text-sm text-gray-400",children:M?"Searching...":`Showing ${u.length} of ${U} products`})]})]})]})})}const O=document.getElementById("dealer-inventory-root");O&&Q.createRoot(O).render(e.jsx(s.StrictMode,{children:e.jsx(ee,{})}));
